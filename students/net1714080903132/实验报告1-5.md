# 实验一：Android开发环境搭建
## 实验目标
搭建 Android（Android Studio）开发环境；
熟悉并掌握Git与GitHub.com提交实验代码的方法。
## 实验步骤（提示）
搭建开发环境（Android Studio），运行（截图）；
需要配置代理服务器。
加入Git项目（Fork），将项目克隆（Clone）到自己帐号下；
$ cd D:\
$ git clone https://github.com/YOUR_NAME/android-labs-2020/
$ cd android-labs-2020
创建以学号命名的个人实验目录(在"我的电脑"里创建)：
   students/soft123456
其中，com开头表示计算机班，soft开头表示软件班，net为网络工程班，sec为网络安全班，数字为个人学号。
## 实验结果
```java
package edu.hzuapps.androidlabs.net1714080903132;

public class Net1714080903132Activity {

}
```
# 实验二：Android组件编程 #2

## 实验要求
在Issues中创建自己的选题：https://github.com/hzuapps/android-labs-2020/issues ；
根据自选题目，编写一个或多个Activity（主窗口类带上学号前缀，放到自己的Java包下）；
将标题设置为自己的学号+对应的功能或题目；
根据自己选择的题目实现Activity中导航、调用等功能（选做）。
参考选题（不要做登录和注册功能）
https://github.com/hzuapps/android-labs-2019/issues

## 实验步骤
https://github.com/hzuapps/android-labs-2020/blob/master/GitHub-lab.md

## 实验要点
根据自己的选题功能，创建 2-3 个 Activity（界面可以尝试设计）；
Net123456Activity.java (首页、LAUNCHER、主活动)
功能1Activity.java
功能2Activity.java
AndroidManifest.xml
在 Activity 上添加按钮、链接或导航栏，实现各个 Activity 的跳转。
在 Net123456Activity.java 添加按钮点击事件处理，实现跳转
## 实验结果
录音功能
```java
package com.example.pl.qzd;

import android.content.Intent;
import android.os.Bundle;
import android.support.annotation.Nullable;
import android.support.v7.app.AppCompatActivity;
import android.view.View;
import android.widget.EditText;
import android.widget.ImageButton;

import com.example.aaa.net1714080903132.R;

public class Net1714080903132LUYIN extends AppCompatActivity{
    EditText editText;
    EditText editText1;
    ImageButton imageButton;
    String money;
    String xx;
    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.luyin);
        getSupportActionBar().hide();


        editText = findViewById(R.id.ET_1);
        editText1 = findViewById(R.id.ET_2);
        imageButton = findViewById(R.id.IB_5);
        Intent intent = getIntent();
        money = intent.getStringExtra("1");
        xx = intent.getStringExtra("2");

        editText.setText(money);
        editText1.setText(xx);


        imageButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                finish();
            }
        });
    }
}
日历功能
package com.example.pl.qzd;

import android.content.Intent;
import android.graphics.Color;
import android.os.Bundle;
import android.support.annotation.Nullable;
import android.support.v7.app.AppCompatActivity;
import android.view.View;
import android.widget.AdapterView;
import android.widget.GridView;
import android.widget.ImageButton;
import android.widget.TextView;

import com.example.aaa.net1714080903132.R;

import java.util.Calendar;

public class Net1714080903132RILI extends AppCompatActivity{
    private int days[][] = new int[6][7];
    private int num[] = new int[2];
    private int top = 0;
    private GridView gridView;

    private DataAdapt dataAdapt;

    private TextView textView;
    private int year;
    private int month;
    private String title;
    private ImageButton imageButton;
    private boolean iscx = false;

    ImageButton imageButton1;
    ImageButton imageButton2;
    ImageButton imageButton3;
    ImageButton imageButton4;

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.rili);
        getSupportActionBar().hide();

        gridView = findViewById(R.id.GV_1);
        textView = findViewById(R.id.TV_1);
        imageButton = findViewById(R.id.IB_1);
        imageButton1 = findViewById(R.id.IB_qian);
        imageButton2 = findViewById(R.id.IB_hou);
        imageButton3 = findViewById(R.id.IB_ss);
        imageButton4 = findViewById(R.id.IB_zxtjt);

        imageButton4.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(Net1714080903132RILI.this, Month.class);
                startActivity(intent);
            }
        });

        imageButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(Net1714080903132RILI.this, Month1.class);
                startActivity(intent);
                iscx = false;
                imageButton.setImageDrawable(getResources().getDrawable(R.drawable.fh));
                gridView.setAdapter(dataAdapt);
                top = 0;
               // finish();
            }
        });

        year = Calendar.getInstance().get(Calendar.YEAR);
        month = Calendar.getInstance().get(Calendar.MONTH) + 1;

        imageButton1.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                month -= 1;
                title = year+"."+month;
                textView.setText(title);
                days = getDayOfMonthFormat(year, month);
                DataAdapt1 dataAdapt1 = new DataAdapt1(Net1714080903132RILI.this, days, year, month);
                gridView.setAdapter(dataAdapt1);
            }
        });

        imageButton2.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                month += 1;
                title = year+"."+month;
                textView.setText(title);
                days = getDayOfMonthFormat(year, month);
                dataAdapt = new DataAdapt(Net1714080903132RILI.this, days, year, month);
                gridView.setAdapter(dataAdapt);
            }
        });
        imageButton3.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                iscx = true;
                imageButton.setImageDrawable(getResources().getDrawable(R.drawable.wc));
                DataAdapt1 dataAdapt1 = new DataAdapt1(Net1714080903132RILI.this, days, year, month);
                gridView.setAdapter(dataAdapt1);
            }
        });

        title = year+"."+month;
        textView.setText(title);

        days = getDayOfMonthFormat(year, month);
        dataAdapt = new DataAdapt(this, days, year, month);
        gridView.setAdapter(dataAdapt);

        gridView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
            @Override
            public void onItemClick(AdapterView<?> adapterView, View view, int i, long l) {
                if(iscx == true){
                    if(top == 1){
                        num[top++] = i;
                        DataAdapt2 dataAdapt2 = new DataAdapt2(Net1714080903132RILI.this, days, year, month,num[0],num[1]);
                        gridView.setAdapter(dataAdapt2);
                    }else{
                        num[top++] = i;
                    }
                    TextView t = view.findViewById(R.id.T_adapt);
                    t.setBackgroundResource(R.drawable.bj4);
                    t.setTextColor(Color.rgb(255,255,255));
                }else{
                    Intent intent = new Intent(Net1714080903132RILI.this, Days.class);
                    intent.putExtra("y", year);
                    intent.putExtra("m", month);
                    int day = (int)adapterView.getAdapter().getItem(i);
                    intent.putExtra("d",day);
                    startActivity(intent);
                }
            }
        });
    }






    public static int[][] getDayOfMonthFormat(int year, int month) {
        Calendar calendar = Calendar.getInstance();
        calendar.set(year, month - 1, 1);//设置时间为每月的第一天
        //设置日历格式数组,6行7列
        int days[][] = new int[6][7];
        //设置该月的第一天是周几
        int daysOfFirstWeek = calendar.get(Calendar.DAY_OF_WEEK);
        //设置本月有多少天
        int daysOfMonth = getDaysOfMonth(year, month);

        int dayNum = 1;


        //将日期格式填充数组
        for (int i = 0; i < days.length; i++) {
            for (int j = 0; j < days[i].length; j++) {
                if(i == 0 && j< daysOfFirstWeek-1){
                    days[i][j] = 0;
                }else if(dayNum <= daysOfMonth){
                    days[i][j] = dayNum++;
                }else{
                    days[i][j] = 0;
                }
            }
        }
        return days;
    }


    public static int getCurrentDayOfWeek() {
        return Calendar.getInstance().get(Calendar.DAY_OF_WEEK);
    }


    public static int getDaysOfMonth(int year, int month) {
        switch (month) {
            case 1:
            case 3:
            case 5:
            case 7:
            case 8:
            case 10:
            case 12:
                return 31;
            case 2:
                if (isLeap(year)) {
                    return 29;
                } else {
                    return 28;
                }
            case 4:
            case 6:
            case 9:
            case 11:
                return 30;
        }
        return -1;
    }
    public static boolean isLeap(int year) {
        if ((year % 4 == 0 && year % 100 != 0) || year % 400 == 0) {
            return true;
        }
        return false;
    }
}
```
# 实验三：Android资源使用编程 #3

## 实验目标
了解Android应用中各种资源的概念与使用方法；
掌握在Android应用中使用图片等资源的方法。
## 实验要求
在界面上显示至少一张图片（按照自己的题目添加）；
提交res/drawable及图片使用的代码；
提交res/values, res/layout等其他代码；
将应用运行结果截图，放到实验报告中；
点击图片（或按钮）时，打开另一个Activity。
##实验步骤（仅供参考，不是直接抄到实验报告）
提交代码的步骤与说明：
https://github.com/hzuapps/android-labs-2020/blob/master/GitHub-lab.md
Android 在TextView 中显示图片的4种方式：
https://blog.csdn.net/u012724237/article/details/79010741
**注意：实验报告中原封不动抄上面2点的本次实验不及格。 **
##实验结果
```java
package com.example.pl.qzd;

import android.content.Intent;
import android.os.Bundle;
import android.support.annotation.Nullable;
import android.support.v7.app.AppCompatActivity;
import android.view.View;
import android.widget.ImageButton;
import android.widget.ImageView;

import com.example.aaa.net1714080903132.R;

public class Month1 extends AppCompatActivity {
    ImageButton imageButton;
    ImageView imageView;

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.month1);
        getSupportActionBar().hide();

        imageButton = findViewById(R.id.IB_qh);
        imageView = findViewById(R.id.IV);

        imageButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                imageView.setImageDrawable(getResources().getDrawable(R.drawable.t4));
                Intent intent = new Intent(Month1.this,Days.class);
                view.getContext().startActivity(intent);

            }
        });

        imageView.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(Month1.this,Days.class);
                view.getContext().startActivity(intent);

            }
        });
    }
    ---------------------------------
    <?xml version="1.0" encoding="utf-8"?>
    <LinearLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:background="@drawable/bj"
        android:orientation="vertical">
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:background="#3d3c3c"
            android:orientation="horizontal">
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center_vertical"
                android:layout_marginLeft="15dp"
                android:text="轻账单"
                android:textColor="#fff"
                android:textSize="18sp" />
            <ImageButton
                android:id="@+id/IB_1"
                android:layout_width="30dp"
                android:layout_height="30dp"
                android:scaleType="fitCenter"
                android:background="#00000000"
                android:layout_gravity="center_vertical"
                android:layout_marginLeft="240dp"
                android:src="@drawable/fh" />

        </LinearLayout>

        <ImageView
            android:id="@+id/IV"
            android:layout_marginTop="30dp"
            android:layout_width="match_parent"
            android:layout_height="300dp"
            android:src="@drawable/t3"
            android:scaleType="fitCenter"
            android:background="#00000000"/>
        <LinearLayout
            android:layout_width="100dp"
            android:layout_height="50dp"
            android:orientation="vertical"
            android:layout_marginLeft="200dp"
            android:layout_marginTop="30dp">

            <ImageButton
                android:id="@+id/IB_qh"
                android:layout_width="30dp"
                android:layout_height="30dp"
                android:scaleType="fitCenter"
                android:layout_gravity="center"
                android:background="#00000000"
                android:src="@drawable/qh"/>
            <TextView
                android:layout_width="wrap_content"
                android:layout_gravity="center"
                android:layout_height="match_parent"
                android:text="切换查看方式"/>
        </LinearLayout>
        -------------------------------------------------
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <color name="colorPrimary">#3F51B5</color>
            <color name="colorPrimaryDark">#303F9F</color>
            <color name="colorAccent">#50933a</color>
        </resources>
        ----------------------------------------------
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <string-array name="array">
                <item>吃饭</item>
                <item>聚会</item>
                <item>约会</item>
                <item>玩乐</item>
                <item>生活杂费</item>
            </string-array>

        </resources>
        ----------------------------------------------------------
        <resources>
            <string name="app_name">轻账单</string>
        </resources>
        -------------------------------------
        <resources>

            <!-- Base application theme. -->
            <style name="AppTheme" parent="Base.Theme.AppCompat.Light.DarkActionBar">
                <!-- Customize your theme here. -->
                <item name="colorPrimary">@color/colorPrimary</item>
                <item name="colorPrimaryDark">@color/colorPrimaryDark</item>
                <item name="colorAccent">@color/colorAccent</item>
            </style>
        </resources>
 ```
 ## 实验截图
 ![res](https://github.com/SparklesStar/android-labs-2020/blob/master/students/net1714080903132/%E5%AE%9E%E9%AA%8C3/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202020-11-29%20201132.png)

# 实验四：Android界面设计编程 #4

## 实验目标
根据选题要求设计界面布局及控件使用；
布局xml及界面控制操作代码提交并截图；
将应用运行结果截图。（不要做登录注册！）
教材内容
developer.android.google.cn - 文档 - 核心主题 - 界面 - 布局
教材：第 2 章 P27-33
实验提交结果
首页 .xml
功能 .xml
功能 .xml
图片 res/drawable/.jpg/png （可选）
以前实验修改 （可选）
## 实验内容
使用其中一种布局方式，设计所选题目的界面，建议用LinearLayout。
LinearLayout, RelativeLayout, Adapter, ConstraintLayout (自学)
通过控件ID获取界面对象，执行相关操作：
// XML
android:id="@+id/my_button"
// Java
findViewById(R.id.my_button);
实现界面控件的事件处理，例如点击按钮：
image
public class MainActivity extends Activity  implements OnClickListener {
            // ......
            @Override
            public void onClick(View v) {
操作之后，切换到你的第二个界面。
## 实验结果
```java
package com.example.pl.qzd;

import android.content.Intent;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.view.MotionEvent;
import android.view.View;
import android.widget.Button;
import android.widget.ImageButton;
import android.widget.TextView;

import com.example.aaa.net1714080903132.R;

import java.util.Calendar;

public class Net1714080903132Activity extends AppCompatActivity {
    ImageButton imageButton0;
    ImageButton imageButton1;
    ImageButton imageButton2;
    ImageButton imageButton3;
    ImageButton imageButton4;
    Button button1;
    TextView textView;
    int year;
    int month;
    int day;
    String title;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        getSupportActionBar().hide();

        imageButton0 = findViewById(R.id.IB_0);
        imageButton1 = findViewById(R.id.IB_1);
        imageButton2 = findViewById(R.id.IB_2);
        imageButton3 = findViewById(R.id.IB_3);
        imageButton4 = findViewById(R.id.IB_4);




        button1 = findViewById(R.id.Bu_1);
        textView =findViewById(R.id.TV_1);

        year = Calendar.getInstance().get(Calendar.YEAR);
        month = Calendar.getInstance().get(Calendar.MONTH) + 1; // 0代表1月、11代表12月
        day = Calendar.getInstance().get(Calendar.DATE);
        title = new String(year+"."+month+"."+day);
        textView.setText(title);

        imageButton0.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(Net1714080903132Activity.this, Ss.class);
                startActivity(intent);
            }
        });


        imageButton1.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(Net1714080903132Activity.this, Tianjiajilu.class);
                startActivity(intent);
            }
        });

        imageButton2.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(Net1714080903132Activity.this, Rili.class);
                startActivity(intent);
            }
        });



        imageButton3.setOnTouchListener(new View.OnTouchListener() {
            @Override
            public boolean onTouch(View view, MotionEvent motionEvent) {
                switch (motionEvent.getAction()) {
                    case MotionEvent.ACTION_DOWN:{
                        imageButton3.setImageDrawable(getResources().getDrawable(R.drawable.luyin2));
                        break;
                    }
                    case MotionEvent.ACTION_UP:{
                        imageButton3.setImageDrawable(getResources().getDrawable(R.drawable.luyin));
                        Intent intent = new Intent(Net1714080903132Activity.this, 功能1Activity.class);
                        intent.putExtra("1", "60");
                        intent.putExtra("2", "今天出去吃饭花了60元");
                        startActivity(intent);
                        break;
                    }
                }
                return true;
            }
        });

        imageButton4.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(Net1714080903132Activity.this, Zong.class);
                startActivity(intent);
            }
        });

        button1.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(Net1714080903132Activity.this, 功能1Activity.class);
                intent.putExtra("1", "50");
                intent.putExtra("2", "今天看电影50元");
                startActivity(intent);
            }
        });
    }
}
-------------------------------------------------------------
package com.example.pl.qzd;

import android.content.Intent;
import android.graphics.Color;
import android.os.Bundle;
import android.support.annotation.DrawableRes;
import android.support.annotation.Nullable;
import android.support.v7.app.AppCompatActivity;
import android.view.View;
import android.widget.AdapterView;
import android.widget.GridView;
import android.widget.ImageButton;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.widget.Toast;

import com.example.aaa.net1714080903132.R;

import java.util.ArrayList;
import java.util.Calendar;
import java.util.List;

public class Rili extends AppCompatActivity{
    private int days[][] = new int[6][7];
    private int num[] = new int[2];
    private int top = 0;
    private GridView gridView;

    private DataAdapt dataAdapt;

    private TextView textView;
    private int year;
    private int month;
    private String title;
    private ImageButton imageButton;
    private boolean iscx = false;

    ImageButton imageButton1;
    ImageButton imageButton2;
    ImageButton imageButton3;
    ImageButton imageButton4;

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.rili);
        getSupportActionBar().hide();

        gridView = findViewById(R.id.GV_1);
        textView = findViewById(R.id.TV_1);
        imageButton = findViewById(R.id.IB_1);
        imageButton1 = findViewById(R.id.IB_qian);
        imageButton2 = findViewById(R.id.IB_hou);
        imageButton3 = findViewById(R.id.IB_ss);
        imageButton4 = findViewById(R.id.IB_zxtjt);

        imageButton4.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(Rili.this, Month.class);
                startActivity(intent);
            }
        });

        imageButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(Rili.this, Month1.class);
                startActivity(intent);
                iscx = false;
                imageButton.setImageDrawable(getResources().getDrawable(R.drawable.fh));
                gridView.setAdapter(dataAdapt);
                top = 0;
               // finish();
            }
        });

        year = Calendar.getInstance().get(Calendar.YEAR);
        month = Calendar.getInstance().get(Calendar.MONTH) + 1;

        imageButton1.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                month -= 1;
                title = year+"."+month;
                textView.setText(title);
                days = getDayOfMonthFormat(year, month);
                DataAdapt1 dataAdapt1 = new DataAdapt1(Rili.this, days, year, month);
                gridView.setAdapter(dataAdapt1);
            }
        });

        imageButton2.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                month += 1;
                title = year+"."+month;
                textView.setText(title);
                days = getDayOfMonthFormat(year, month);
                dataAdapt = new DataAdapt(Rili.this, days, year, month);
                gridView.setAdapter(dataAdapt);
            }
        });
        imageButton3.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                iscx = true;
                imageButton.setImageDrawable(getResources().getDrawable(R.drawable.wc));
                DataAdapt1 dataAdapt1 = new DataAdapt1(Rili.this, days, year, month);
                gridView.setAdapter(dataAdapt1);
            }
        });

        title = year+"."+month;
        textView.setText(title);

        days = getDayOfMonthFormat(year, month);
        dataAdapt = new DataAdapt(this, days, year, month);
        gridView.setAdapter(dataAdapt);

        gridView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
            @Override
            public void onItemClick(AdapterView<?> adapterView, View view, int i, long l) {
                if(iscx == true){
                    if(top == 1){
                        num[top++] = i;
                        DataAdapt2 dataAdapt2 = new DataAdapt2(Rili.this, days, year, month,num[0],num[1]);
                        gridView.setAdapter(dataAdapt2);
                    }else{
                        num[top++] = i;
                    }
                    TextView t = view.findViewById(R.id.T_adapt);
                    t.setBackgroundResource(R.drawable.bj4);
                    t.setTextColor(Color.rgb(255,255,255));
                }else{
                    Intent intent = new Intent(Rili.this, Days.class);
                    intent.putExtra("y", year);
                    intent.putExtra("m", month);
                    int day = (int)adapterView.getAdapter().getItem(i);
                    intent.putExtra("d",day);
                    startActivity(intent);
                }
            }
        });
    }






    public static int[][] getDayOfMonthFormat(int year, int month) {
        Calendar calendar = Calendar.getInstance();
        calendar.set(year, month - 1, 1);//设置时间为每月的第一天
        //设置日历格式数组,6行7列
        int days[][] = new int[6][7];
        //设置该月的第一天是周几
        int daysOfFirstWeek = calendar.get(Calendar.DAY_OF_WEEK);
        //设置本月有多少天
        int daysOfMonth = getDaysOfMonth(year, month);

        int dayNum = 1;


        //将日期格式填充数组
        for (int i = 0; i < days.length; i++) {
            for (int j = 0; j < days[i].length; j++) {
                if(i == 0 && j< daysOfFirstWeek-1){
                    days[i][j] = 0;
                }else if(dayNum <= daysOfMonth){
                    days[i][j] = dayNum++;
                }else{
                    days[i][j] = 0;
                }
            }
        }
        return days;
    }


    public static int getCurrentDayOfWeek() {
        return Calendar.getInstance().get(Calendar.DAY_OF_WEEK);
    }


    public static int getDaysOfMonth(int year, int month) {
        switch (month) {
            case 1:
            case 3:
            case 5:
            case 7:
            case 8:
            case 10:
            case 12:
                return 31;
            case 2:
                if (isLeap(year)) {
                    return 29;
                } else {
                    return 28;
                }
            case 4:
            case 6:
            case 9:
            case 11:
                return 30;
        }
        return -1;
    }
    public static boolean isLeap(int year) {
        if ((year % 4 == 0 && year % 100 != 0) || year % 400 == 0) {
            return true;
        }
        return false;
    }
```
# 实验五：Android存储编程 #5

## 实验目标
 + 了解Andoid的存储手段
 + 掌握Android的文件存储
 + 掌握Android的数据库存储
## 实验内容一（选做1个）
根据选题要求使用文件存储
将应用产生的数据保存到文件存储中；
说明使用的文件存储方式：内部 or 外部；
将运行结果截图。
## 实验结果
```java
package com.example.pl.qzd;

import android.Manifest;
import android.annotation.TargetApi;
import android.app.ActionBar;
import android.content.ContentUris;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.database.Cursor;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.net.Uri;
import android.os.Build;
import android.os.Bundle;
import android.provider.DocumentsContract;
import android.provider.MediaStore;
import android.support.annotation.NonNull;
import android.support.annotation.Nullable;
import android.support.v4.app.ActivityCompat;
import android.support.v4.content.ContextCompat;
import android.support.v4.content.FileProvider;
import android.support.v7.app.AppCompatActivity;
import android.util.TypedValue;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AbsoluteLayout;
import android.widget.ImageButton;
import android.widget.ImageView;
import android.widget.PopupMenu;
import android.widget.Toast;

import com.example.aaa.net1714080903132.R;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.IOException;

public class Tianjiajilu extends AppCompatActivity{

    ImageButton imageButton1;
    ImageButton imageButton2;
    ImageView imageView;


    private Uri uriImage;
    private File image;
    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.tianjiajilu);
        getSupportActionBar().hide();

        imageButton1 = findViewById(R.id.IB_5);
        imageButton2 = findViewById(R.id.IB_pz);
        imageView = findViewById(R.id.IV);
        imageButton1.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                finish();
            }
        });

        imageButton2.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                showOrderWayMenu(view);
            }
        });

    }
    private void showOrderWayMenu(View view){
        PopupMenu popupMenu=new PopupMenu(this,view);
        popupMenu.getMenuInflater().inflate(R.menu.menu,popupMenu.getMenu());
        popupMenu.setOnMenuItemClickListener(new PopupMenu.OnMenuItemClickListener() {
            @Override
            public boolean onMenuItemClick(MenuItem item) {
                if(item.getTitle().equals("拍照选择")){
                    image = new File(getExternalCacheDir(),"123.jpg");
                    try {
                        if(image.exists()){
                            image.delete();
                        }
                        image.createNewFile();
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                    if(Build.VERSION.SDK_INT >= 24){
                        uriImage = FileProvider.getUriForFile(Tianjiajilu.this, "comxf.activity.provider.download1", image);
                    }else{
                        uriImage = Uri.fromFile(image);
                    }
                    Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
                    intent.putExtra(MediaStore.EXTRA_OUTPUT, uriImage);
                    startActivityForResult(intent, 1);
                }
                if(item.getTitle().equals("从相册中选择")){
                    if(ContextCompat.checkSelfPermission(Tianjiajilu.this,
                            Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED){
                        ActivityCompat.requestPermissions(Tianjiajilu.this,
                                new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE},1);
                    }else{
                        openAlbum();
                    }
                }
                return false;
            }
        });
        popupMenu.show();
    }

    @Override
    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {
        super.onActivityResult(requestCode, resultCode, data);
        switch (requestCode){
            case 1:
                if(resultCode == RESULT_OK){
                    try {
                        Bitmap bitmap = BitmapFactory.decodeStream(getContentResolver().openInputStream(uriImage));
                        imageView.setImageBitmap(bitmap);
                        ViewGroup.LayoutParams params;
                        params = imageView.getLayoutParams();
                        params.height = (int)TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 75, getResources().getDisplayMetrics());
                        params.width = (int)TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 75, getResources().getDisplayMetrics());
                        imageView.setLayoutParams(params);
                    } catch (FileNotFoundException e) {
                        e.printStackTrace();
                    }
                }break;
            case 2:
                if(resultCode == RESULT_OK){
                    if(Build.VERSION.SDK_INT >= 19){
                        handleImageOnKitKat(data);
                    }else{
                        handleImageBeforeKitKat(data);
                    }
                }break;
        }
    }
    private void openAlbum(){
        Intent intent = new Intent("android.intent.action.GET_CONTENT");
        intent.setType("image/*");//设置intent的接受类型为image图片类
        startActivityForResult(intent, 2);
    }
    @Override
    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);

        switch (requestCode){
            case 1:
                if(grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED){
                    openAlbum();
                }else{
                    Toast.makeText(this, "没有权限", Toast.LENGTH_SHORT).show();
                }break;
        }
    }
    @TargetApi(19)
    private void handleImageOnKitKat(Intent data){
        String imagepath = null;
        Uri uri = data.getData();
        if(DocumentsContract.isDocumentUri(this, uri)){     //判断是不是Documents类
            String docId  = DocumentsContract.getDocumentId(uri);
            if("com.android.providers.media.documents".equals(uri.getAuthority())){
                String id = docId.split(":")[1];
                String selection = MediaStore.Images.Media._ID + "=" + id;
                imagepath = getImagePath(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, selection);
            }else if("com.android.providers.downloads.documents".equals(uri.getAuthority())){
                Uri contentUri = ContentUris.withAppendedId(Uri.parse("content://downloads/public_downloads"),
                        Long.valueOf(docId));//连接连个Uri
                imagepath = getImagePath(contentUri, null);
            }
        }else if("content".equalsIgnoreCase(uri.getScheme())){
            imagepath = getImagePath(uri, null);
        }else if("file".equalsIgnoreCase(uri.getScheme())){
            imagepath = uri.getPath();
        }
        displayImage(imagepath);
    }
    private void handleImageBeforeKitKat(Intent data){
        Uri uri = data.getData();
        String imagePath = getImagePath(uri, null);
        displayImage(imagePath);
    }

    private String getImagePath(Uri uri, String selection){
        String path = null;
        Cursor cursor = getContentResolver().query(uri, null, selection, null,null);
        if(cursor != null){
            if(cursor.moveToFirst()){
                path = cursor.getString(cursor.getColumnIndex(MediaStore.Images.Media.DATA));
            }
            cursor.close();
        }
        return path;
    }

    private void displayImage(String imagePath){
        if(imagePath != null){
            Bitmap bitmap = BitmapFactory.decodeFile(imagePath);
            imageView.setImageBitmap(bitmap);
            ViewGroup.LayoutParams params;
            params = imageView.getLayoutParams();
            params.height = (int)TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 75, getResources().getDisplayMetrics());
            params.width = (int)TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 75, getResources().getDisplayMetrics());
            imageView.setLayoutParams(params);
        }else{
            Toast.makeText(this, "找不到图片",Toast.LENGTH_SHORT).show();
        }
    }
}
——————————————————————————————————
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@drawable/bj"
    android:orientation="vertical">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="50dp"
        android:background="#3d3c3c"
        android:orientation="horizontal">
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_gravity="center_vertical"
            android:layout_marginLeft="15dp"
            android:text="轻账单"
            android:textColor="#fff"
            android:textSize="18sp" />
        <ImageButton
            android:id="@+id/IB_5"
            android:layout_width="30dp"
            android:layout_height="30dp"
            android:scaleType="fitCenter"
            android:background="#00000000"
            android:layout_gravity="center_vertical"
            android:layout_marginLeft="240dp"
            android:src="@drawable/wc" />
    </LinearLayout>

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="350dp"
        android:layout_marginTop="30dp"
        android:layout_marginLeft="30dp"
        android:layout_marginRight="30dp"
        android:background="@drawable/bj3"
        android:orientation="vertical"
        >
        <LinearLayout
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginLeft="25dp"
            android:layout_marginTop="25dp">
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="金额："
                android:textSize="20sp"
                android:textColor="#000000" />
            <EditText
                android:layout_marginLeft="5dp"
                android:layout_width="125dp"
                android:layout_height="40dp"
                android:inputType="number"/>
        </LinearLayout>
        <LinearLayout
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginLeft="25dp"
            android:layout_marginTop="25dp">
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="类型："
                android:textSize="20sp"
                android:textColor="#000000" />
            <Spinner
                android:layout_marginLeft="5dp"
                android:layout_width="125dp"
                android:layout_height="35dp"
                android:entries="@array/array"/>
        </LinearLayout>
        <LinearLayout
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginLeft="25dp"
            android:layout_marginTop="25dp">
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="详细："
                android:textSize="20sp"
                android:textColor="#000000" />
            <EditText
                android:layout_marginLeft="5dp"
                android:layout_width="125dp"
                android:layout_height="wrap_content"
                android:inputType="textMultiLine"/>
        </LinearLayout>
    </LinearLayout>
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_margin="30dp"
        android:background="@drawable/bj2">
        <ImageView
            android:id="@+id/IV"
            android:scaleType="fitCenter"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content" />
        <ImageButton
            android:id="@+id/IB_pz"
            android:layout_width="70dp"
            android:layout_height="70dp"
            android:src="@drawable/tjtp"
            android:scaleType="fitCenter"
            android:layout_gravity="center"
            android:background="#00000000"/>
    </LinearLayout>
</LinearLayout>
--------------------
```
## 实验截图
![res](https://github.com/SparklesStar/android-labs-2020/blob/master/students/net1714080903132/%E5%AE%9E%E9%AA%8C5/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202020-11-29%20204736.png)
